# 个股组合回测策略

## 概述

个股组合回测策略允许你选择多个股票构建投资组合，并配置股票与现金的仓位比例。剩余的现金部分将享受国债利息收益。

## 功能特点

### 1. 多股票选择
- 支持从预设的个股列表中选择多个股票
- 按行业分类展示，便于选择
- 支持按行业全选/取消全选
- 包含以下行业：
  - 银行保险证券
  - 能源行业
  - 消费行业
  - 新能源&汽车

### 2. 灵活的仓位配置
- **股票仓位比例**：可配置 0% - 100%
- **现金比例**：自动计算（100% - 股票比例）
- 现金部分享受国债利息（10年期国债利率）

### 3. 等权重再平衡（可选）
- 支持定期将所有股票调整为等权重
- 可配置再平衡间隔（1-12个月）
- 帮助控制风险，保持组合平衡

### 4. 回测结果展示
- 组合总价值变化曲线
- 总收益率
- 年化收益率
- 最大回撤
- 年度详情（包含持仓信息）

## 使用方法

### 基本使用

1. **选择股票**
   - 在界面上勾选你想要投资的股票
   - 可以单独选择，也可以按行业全选
   - 建议选择 3-10 只股票以分散风险

2. **配置仓位**
   - 拖动滑块调整股票仓位比例
   - 例如：70% 股票 + 30% 现金

3. **配置再平衡（可选）**
   - 勾选"启用定期再平衡"
   - 选择再平衡间隔（建议 3-6 个月）

4. **查看结果**
   - 图表展示组合价值变化
   - 卡片展示关键指标
   - 年度详情展示每年的持仓和收益

## 策略说明

### Buy and Hold 策略（不启用再平衡）

这是最简单的策略：
1. 初始按照设定的股票仓位比例买入所有选中的股票
2. 股票之间按等权重分配（例如选择3只股票，每只占总股票仓位的 1/3）
3. 持有不动，直到回测结束
4. 现金部分享受国债利息

**适用场景：**
- 长期投资
- 相信持有优质股票会带来良好收益
- 减少交易成本

### 等权重再平衡策略

定期将所有股票调整回等权重：
1. 初始按等权重买入所有股票
2. 每隔固定时间（如3个月），将所有股票调整回等权重
3. 卖出涨幅较大的股票，买入涨幅较小的股票
4. 现金部分始终保持不变（享受国债利息）

**适用场景：**
- 相信均值回归
- 控制单一股票风险
- 自动止盈、加仓

**再平衡示例：**
```
初始状态（总资产 100万，70%股票 + 30%现金）：
- 股票A：23.33万（70万的1/3）
- 股票B：23.33万
- 股票C：23.33万
- 现金：30万

3个月后（股票A涨了50%，B跌了10%，C不变）：
- 股票A：35万（涨了）
- 股票B：21万（跌了）
- 股票C：23.33万（不变）
- 现金：30万
- 总资产：109.33万

再平衡后：
- 股票A：27.88万（卖出7.12万）
- 股票B：27.88万（买入6.88万）
- 股票C：27.88万（买入4.55万）
- 现金：25.68万（减少了4.32万用于交易）
```

## 配置建议

### 保守型投资者
- **股票仓位**：30% - 50%
- **现金比例**：50% - 70%
- **股票数量**：5-8 只（充分分散）
- **再平衡**：每 6 个月
- **选股方向**：银行、保险等稳定行业

### 平衡型投资者
- **股票仓位**：50% - 70%
- **现金比例**：30% - 50%
- **股票数量**：4-6 只
- **再平衡**：每 3-6 个月
- **选股方向**：混合各行业

### 激进型投资者
- **股票仓位**：70% - 100%
- **现金比例**：0% - 30%
- **股票数量**：3-5 只（集中投资）
- **再平衡**：每 1-3 个月
- **选股方向**：成长性行业（新能源、消费）

## 示例组合

### 示例1：稳健银行组合
```
股票选择：
- 招商银行 (600036)
- 中国银行 (601988)
- 成都银行 (601838)
- 杭州银行 (600926)

配置：
- 股票仓位：60%
- 现金比例：40%
- 再平衡：每 6 个月
```

### 示例2：高股息组合
```
股票选择：
- 中国神华 (601088)
- 中国银行 (601988)
- 中国移动 (600941)
- 招商银行 (600036)

配置：
- 股票仓位：70%
- 现金比例：30%
- 再平衡：每 3 个月
```

### 示例3：成长+价值平衡
```
股票选择：
- 宁德时代 (300750) - 成长
- 比亚迪 (002594) - 成长
- 招商银行 (600036) - 价值
- 中国神华 (601088) - 价值

配置：
- 股票仓位：80%
- 现金比例：20%
- 再平衡：每 3 个月
```

## 技术实现

### 数据结构

```typescript
interface StockPortfolioConfig {
  stockCodes: string[]; // 股票代码列表
  stockRatio: number; // 股票占总仓位的比例 (0-1)
}
```

### 计算流程

1. **数据获取**
   - 从 Lixinger API 获取所有选中股票的历史价格数据
   - 按日期对齐（只保留所有股票都有数据的日期）

2. **初始化**
   - 计算股票部分和现金部分的金额
   - 股票按等权重分配
   - 根据初始价格计算每只股票的份额

3. **每日更新**
   - 更新每只股票的价格
   - 现金每月计息（使用10年期国债利率）
   - 如果启用再平衡且到达再平衡日期，执行再平衡操作

4. **结果计算**
   - 计算每日的组合总价值
   - 计算收益率、年化收益率、最大回撤
   - 生成年度详情报告

## API 调用示例

```typescript
import { calculateStockPortfolio } from './calculations';

const stockDataMap = {
  '600036': [...], // 招商银行数据
  '601988': [...], // 中国银行数据
  '601088': [...], // 中国神华数据
};

const config = {
  stockCodes: ['600036', '601988', '601088'],
  stockRatio: 0.7, // 70% 股票
};

const result = calculateStockPortfolio(
  stockDataMap,
  100000, // 初始资金 10万
  config
);

console.log('最终价值:', result.finalValue);
console.log('总收益率:', result.totalReturn);
console.log('年化收益率:', result.annualizedReturn);
console.log('最大回撤:', result.maxDrawdown);
```

## 注意事项

1. **数据对齐**
   - 策略只会使用所有选中股票都有数据的日期
   - 如果某只股票上市较晚，回测起始日期会自动调整

2. **交易成本**
   - 当前实现**未考虑**交易手续费和印花税
   - 实际收益会略低于回测结果
   - 再平衡频率越高，实际交易成本越高

3. **现金利息**
   - 使用10年期国债到期收益率作为现金利息
   - 实际货币基金收益可能略有不同

4. **停牌风险**
   - 回测不考虑股票停牌情况
   - 实际投资中可能面临流动性风险

5. **历史回测局限性**
   - 历史表现不代表未来收益
   - 回测结果仅供参考，不构成投资建议

## 路由地址

访问路径：`/backtest/stock-portfolio`

## 相关文件

- 计算逻辑：`src/app/backtest/stock-portfolio/calculations.ts`
- UI 页面：`src/app/backtest/stock-portfolio/page.tsx`
- 测试文件：`src/app/backtest/stock-portfolio/calculations.test.ts`
- 股票列表：`src/constants/stocks.ts`

## 后续优化方向

1. **动态权重分配**
   - 支持按市值权重分配
   - 支持自定义每只股票的权重

2. **更多再平衡策略**
   - 按估值再平衡
   - 按波动率调整权重
   - 动态调整股债比例

3. **风险控制**
   - 添加止损功能
   - 添加最大回撤控制
   - 行业配置限制

4. **交易成本**
   - 加入手续费计算
   - 加入印花税计算
   - 显示总交易成本

5. **更多图表**
   - 各股票占比饼图
   - 行业配置图
   - 每只股票的收益曲线

